<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pencatatan Konten Mobil - Pekan</title>
  <style>
    :root{--bg:#f6f8fa;--card:#fff;--accent:#2563eb;--muted:#6b7280}
    body{font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:var(--bg); margin:0; padding:24px}
    .container{max-width:900px;margin:0 auto}
    h1{font-size:1.5rem;margin:0 0 8px}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .card{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 2px 6px rgba(16,24,40,.06);margin-bottom:16px}
    form .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    label{font-size:.85rem;color:var(--muted);display:block;margin-bottom:4px}
    input,select,textarea{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:8px;font-size:.95rem;box-sizing:border-box}
    button{background:var(--accent);color:#fff;border:0;padding:8px 14px;border-radius:8px;cursor:pointer;transition:background .2s}
    button:hover{background:#1d4ed8}
    button.secondary{background:#374151}
    button.secondary:hover{background:#111827}
    table{width:100%;border-collapse:collapse;font-size:.9rem;margin-top:8px}
    th,td{padding:10px 8px;border-bottom:1px solid #e5e7eb;text-align:left}
    .pill{display:inline-block;padding:3px 8px;border-radius:999px;background:#eef2ff;color:var(--accent);font-weight:600;font-size:.8rem}
    .actions button{margin-right:6px}
    .muted{color:var(--muted)}
    @media(max-width:700px){form .grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <h1>Pencatatan Konten Mobil</h1>
    <p class="lead">Form sederhana untuk mendata mobil yang sudah dikontent per pekan agar tim tidak membuat konten ganda.</p>

    <div class="card">
      <form id="entryForm">
        <div class="grid">
          <div>
            <label for="date">Tanggal</label>
            <input type="date" id="date" required />
          </div>
          <div>
            <label for="week">Pekan (minggu)</label>
            <select id="week">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </div>
          <div>
            <label for="platform">Platform</label>
            <select id="platform">
              <option value="Instagram">Instagram</option>
              <option value="Facebook">Facebook</option>
              <option value="YouTube">YouTube</option>
              <option value="Tiktok">Tiktok</option>
              <option value="Lain-lain">Lain-lain</option>
            </select>
          </div>
          <div>
            <label for="make">Merek</label>
            <input type="text" id="make" placeholder="Toyota" />
          </div>
          <div>
            <label for="model">Model</label>
            <input type="text" id="model" placeholder="Avanza" />
          </div>
          <div>
            <label for="title">Judul Konten</label>
            <input type="text" id="title" placeholder="Review Avanza 2020 - Interior" />
          </div>
        </div>

        <div style="margin-top:10px">
          <label for="notes">Catatan (opsional)</label>
          <textarea id="notes" rows="2" placeholder="mis. lokasi, durasi, creator"></textarea>
        </div>

        <div style="margin-top:14px;display:flex;flex-wrap:wrap;gap:8px;align-items:center">
          <button type="submit">Simpan</button>
          <button type="button" id="clearForm" class="secondary">Reset Form</button>
          <div style="flex:1"></div>
          <button type="button" id="exportCsv">Ekspor CSV</button>
          <button type="button" id="importJson" class="secondary">Import JSON</button>
        </div>
        <p id="msg" class="muted" style="margin-top:8px"></p>
      </form>
    </div>

    <div class="card">
      <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:10px">
        <input type="text" id="search" placeholder="Cari (merek, model, judul)" style="flex:1;padding:10px;border:1px solid #e5e7eb;border-radius:8px" />
        <select id="filterWeek">
          <option value="all">Semua Pekan</option>
          <option value="1">Pekan 1</option>
          <option value="2">Pekan 2</option>
          <option value="3">Pekan 3</option>
          <option value="4">Pekan 4</option>
          <option value="5">Pekan 5</option>
        </select>
        <button id="clearAll" class="secondary">Hapus Semua</button>
      </div>

      <div style="overflow:auto">
        <table id="table">
          <thead>
            <tr><th>Tanggal</th><th>Pekan</th><th>Platform</th><th>Merek</th><th>Model</th><th>Judul</th><th>Posted</th><th>Aksi</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <p class="muted">Catatan: sistem menyimpan data di browser (localStorage). Untuk berbagi file, gunakan tombol ekspor CSV atau salin JSON (import di perangkat lain).</p>
  </div>

<script>
const KEY = 'carPosts_v2';
let entries = JSON.parse(localStorage.getItem(KEY) || '[]');

const form = document.getElementById('entryForm');
const msg = document.getElementById('msg');
const tableBody = document.querySelector('#table tbody');
const dateInput = document.getElementById('date');
const weekInput = document.getElementById('week');
const searchInput = document.getElementById('search');
const filterWeek = document.getElementById('filterWeek');

const today = new Date().toISOString().slice(0,10);
dateInput.value = today;
weekInput.value = calcWeekFromDate(today);

dateInput.addEventListener('change', e => weekInput.value = calcWeekFromDate(e.target.value));

function calcWeekFromDate(dstr){
  if(!dstr) return 1;
  const d = new Date(dstr);
  return Math.ceil(d.getDate() / 7).toString();
}

function save(){ localStorage.setItem(KEY, JSON.stringify(entries)); }
function render(){
  tableBody.innerHTML = '';
  const q = searchInput.value.trim().toLowerCase();
  const fW = filterWeek.value;
  entries.forEach((e, i) => {
    if(fW !== 'all' && e.week !== fW) return;
    if(q){
      const hay = [(e.make||''),(e.model||''),(e.title||''),(e.platform||'')].join(' ').toLowerCase();
      if(!hay.includes(q)) return;
    }
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${e.date}</td>
      <td><span class="pill">${e.week}</span></td>
      <td>${escapeHtml(e.platform)}</td>
      <td>${escapeHtml(e.make||'-')}</td>
      <td>${escapeHtml(e.model||'-')}</td>
      <td>${escapeHtml(e.title||'-')}</td>
      <td style="text-align:center"><input type="checkbox" data-i="${i}" class="posted" ${e.posted? 'checked':''}></td>
      <td class="actions">
        <button data-i="${i}" class="edit">Edit</button>
        <button data-i="${i}" class="del">Hapus</button>
      </td>`;
    tableBody.appendChild(tr);
  });
}

function escapeHtml(s){return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));}

form.addEventListener('submit', e => {
  e.preventDefault();
  const data = {
    date: dateInput.value,
    week: weekInput.value,
    platform: document.getElementById('platform').value,
    make: document.getElementById('make').value.trim(),
    model: document.getElementById('model').value.trim(),
    title: document.getElementById('title').value.trim(),
    notes: document.getElementById('notes').value.trim(),
    posted: false
  };
  if(!data.date || !data.title){ msg.textContent = 'Isi tanggal dan judul konten.'; return; }
  const dup = entries.find(x => x.title.toLowerCase() === data.title.toLowerCase() && x.week === data.week && x.platform === data.platform);
  if(dup){ msg.innerHTML = `⚠️ Judul yang sama sudah ada di pekan ${data.week} (${data.platform}).`; return; }
  entries.unshift(data);
  save(); render();
  form.reset(); dateInput.value = today; weekInput.value = calcWeekFromDate(today);
  msg.textContent = 'Tersimpan ✓'; setTimeout(()=>msg.textContent='',1500);
});

tableBody.addEventListener('click', e => {
  const t = e.target, i = t.getAttribute('data-i');
  if(t.classList.contains('del')){
    if(confirm('Hapus entri ini?')){ entries.splice(i,1); save(); render(); }
  }else if(t.classList.contains('edit')){
    const ent = entries[i];
    dateInput.value = ent.date; weekInput.value = ent.week; document.getElementById('platform').value = ent.platform;
    document.getElementById('make').value = ent.make; document.getElementById('model').value = ent.model; document.getElementById('title').value = ent.title; document.getElementById('notes').value = ent.notes;
    entries.splice(i,1); save(); render(); msg.textContent = 'Edit mode: ubah lalu klik Simpan.';
  }
});

tableBody.addEventListener('change', e => {
  if(e.target.classList.contains('posted')){
    const i = e.target.getAttribute('data-i');
    entries[i].posted = e.target.checked; save();
  }
});

searchInput.addEventListener('input', render);
filterWeek.addEventListener('change', render);

document.getElementById('clearForm').addEventListener('click', ()=>{form.reset(); dateInput.value = today; weekInput.value = calcWeekFromDate(today); msg.textContent='Form di-reset'; setTimeout(()=>msg.textContent='',1200);});

document.getElementById('clearAll').addEventListener('click', ()=>{if(confirm('Hapus semua data?')){entries=[]; save(); render();}});

document.getElementById('exportCsv').addEventListener('click', ()=>{
  if(entries.length===0){ alert('Belum ada data.'); return; }
  const hdr = ['Tanggal','Pekan','Platform','Merek','Model','Judul','Catatan','Posted'];
  const lines = [hdr.join(',')];
  entries.forEach(r=>{lines.push([r.date,r.week,r.platform,r.make,r.model,r.title,r.notes,r.posted].map(x=>`"${String(x||'').replace(/"/g,'""')}"`).join(','));});
  const blob = new Blob([lines.join('\n')],{type:'text/csv'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='konten_mobil.csv';a.click();URL.revokeObjectURL(a.href);
});

document.getElementById('importJson').addEventListener('click', ()=>{
  const pasted = prompt('Tempel JSON array di sini:'); if(!pasted) return;
  try{const arr = JSON.parse(pasted); if(!Array.isArray(arr)) throw new Error('Format salah'); arr.forEach(x=>{if(x.date && x.title){entries.unshift({...x, posted:false});}}); save(); render(); alert('Import selesai');}
  catch(err){alert('JSON tidak valid: '+err.message);}
});

render();
</script>
</body>
</html>
